

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Hardening PAM &mdash; Sécurité Linux v1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Applications des correctifs" href="application_correctifs.html" />
    <link rel="prev" title="Procédure d’installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Sécurité Linux
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Niveau minimal ANSSI</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Procédure d’installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Hardening PAM</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#classification">Classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sources">Sources</a></li>
<li class="toctree-l2"><a class="reference internal" href="#procedures">Procédures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#desactivation-du-compte-root">Désactivation du compte root</a></li>
<li class="toctree-l3"><a class="reference internal" href="#contres-mesures-contre-le-bruteforce">Contres mesures contre le bruteforce</a></li>
<li class="toctree-l3"><a class="reference internal" href="#politiques-de-complexite-des-mots-de-passe">Politiques de complexité des mots de passe</a></li>
<li class="toctree-l3"><a class="reference internal" href="#double-authentification">Double authentification</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#commentaires">Commentaires</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="application_correctifs.html">Applications des correctifs</a></li>
</ul>
<p class="caption"><span class="caption-text">Niveau intermédiaire ANSSI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="parefeu_local.html">Parefeu local</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardening_openssh.html">Hardening de OpenSSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="confinement_droits_sudo.html">Confinement des droits sudo</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardening_grub.html">Hardening de Grub</a></li>
<li class="toctree-l1"><a class="reference internal" href="desactivation_magickeys.html">Désactivation des Magic keys</a></li>
<li class="toctree-l1"><a class="reference internal" href="rsyslog.html">Rsyslog</a></li>
</ul>
<p class="caption"><span class="caption-text">Niveau renforcé ANSSI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="auditd.html">Auditd</a></li>
</ul>
<p class="caption"><span class="caption-text">Niveau élevé ANSSI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="apparmor.html">Mise en place de AppArmor</a></li>
</ul>
<p class="caption"><span class="caption-text">Audits de sécurité</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="audit_lynis.html">Audit Lynis</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Sécurité Linux</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Hardening PAM</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/src/hardening_PAM.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="hardening-pam">
<h1>Hardening PAM<a class="headerlink" href="#hardening-pam" title="Permalink to this headline">¶</a></h1>
<p>PAM est un élément central de notre système Linux, gérant les authentifications des utilisateurs. Il est donc primordial de le durcir.</p>
<div class="section" id="classification">
<h2>Classification<a class="headerlink" href="#classification" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Niveau ANSSI : minimal</p></li>
<li><p>Principes : Défence en profondeur</p></li>
<li><p>Authentification</p></li>
<li><p>Gestion des comptes</p></li>
<li><p>Double authentification</p></li>
<li><p>Défense en profondeur</p></li>
</ul>
</div>
<div class="section" id="sources">
<h2>Sources<a class="headerlink" href="#sources" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf">ANSSI</a></p></li>
<li><p><a class="reference external" href="https://www.vultr.com/docs/how-to-setup-two-factor-authentication-2fa-for-ssh-on-debian-9-using-google-authenticator">2FA</a></p></li>
</ul>
</div>
<div class="section" id="procedures">
<h2>Procédures<a class="headerlink" href="#procedures" title="Permalink to this headline">¶</a></h2>
<p>Commençons par installer la librairie <em>libpam</em> :</p>
<p><img alt="../_images/install_libpam.PNG" src="../_images/install_libpam.PNG" /></p>
<div class="section" id="desactivation-du-compte-root">
<h3>Désactivation du compte root<a class="headerlink" href="#desactivation-du-compte-root" title="Permalink to this headline">¶</a></h3>
<p>Le but de cette étape est de bloquer l’accès au compte root. Pour cela, nous allons utiliser deux mécanismes :</p>
<ul class="simple">
<li><p>interdiction au groupe <em>wheel</em> (groupe que nous allons créer pour les superutilisateurs) de se connecter en tant que root</p></li>
<li><p>désactivation du shell de l’utilisateur root</p></li>
</ul>
<p>Le groupe <em>wheel</em> est l’équivalent du groupe <em>sudo</em> chez RedHat.</p>
<p>Commençons par créer le groupe <em>wheel</em> :</p>
<p><img alt="../_images/group_wheel.PNG" src="../_images/group_wheel.PNG" /></p>
<p>Bloquons ensuite l’accès au compte root aux membres du groupe <em>wheel</em> :</p>
<p><img alt="../_images/disable_root_wheel.PNG" src="../_images/disable_root_wheel.PNG" /></p>
<p><img alt="../_images/disable_root_wheel_2.PNG" src="../_images/disable_root_wheel_2.PNG" /></p>
<p>Pour que ce mécanisme fonctionne, il est impératif d’ajouter les superutilisateurs (membres du groupe <em>sudo</em>) au groupe <em>wheel</em>.</p>
<p>Désactivons enfin le shell de l’utilisateur root :</p>
<p><img alt="../_images/disable_root.PNG" src="../_images/disable_root.PNG" /></p>
</div>
<div class="section" id="contres-mesures-contre-le-bruteforce">
<h3>Contres mesures contre le bruteforce<a class="headerlink" href="#contres-mesures-contre-le-bruteforce" title="Permalink to this headline">¶</a></h3>
<p>Limitons le nombre de tentative d’authentification :</p>
<p><img alt="../_images/bruteforce_pass_sshd.PNG" src="../_images/bruteforce_pass_sshd.PNG" /></p>
<p><img alt="../_images/bruteforce_pass_login.PNG" src="../_images/bruteforce_pass_login.PNG" /></p>
<p>Le choix de bloquer pendant <strong>10 minutes</strong> au bout de <strong>5 authentifications échouées</strong> nous semble être un bon compromis entre le fait d’éviter de bloquer un utilisateur qui se serait trompé de mots de passe, et une réelle attaque par Bruteforce.</p>
</div>
<div class="section" id="politiques-de-complexite-des-mots-de-passe">
<h3>Politiques de complexité des mots de passe<a class="headerlink" href="#politiques-de-complexite-des-mots-de-passe" title="Permalink to this headline">¶</a></h3>
<p>Définissons une politique de password pour forcer les utilisateurs à respecter les bonnes pratiques de sécurité.</p>
<p><img alt="../_images/password_policy.PNG" src="../_images/password_policy.PNG" /></p>
<p>Dans cette politique, on demande à avoir au moins 16 caractères dans le mot de passe, et qu’il contienne au moins un mélange de chiffres, de lettres et de majuscules. Cette politique est cohérente avec les recommandations de l’ANSSI. Nous ne souhaitons pas forcer l’usage de caractères spéciaux, puisqu’ils peuvent être sujet à erreur en fonctions des claviers ou des encodages utilisés.</p>
<p>Testons cette politique :</p>
<p><img alt="../_images/password_policy_poc.PNG" src="../_images/password_policy_poc.PNG" /></p>
<p>Définissons enfin une politique de stockage des mots de passe forte :</p>
<p><img alt="../_images/common-password.PNG" src="../_images/common-password.PNG" /></p>
<p>Avec un nombre de <em>round</em> particulièrement haut et l’usage de sha512, les mots de passe stockés ne devraient pas être sujet à du Brutefoce sur les empreintes.</p>
</div>
<div class="section" id="double-authentification">
<h3>Double authentification<a class="headerlink" href="#double-authentification" title="Permalink to this headline">¶</a></h3>
<p>Une bonne pratique est également de mettre en place la double authentification, pour éviter le cas où un attaquant pourrait se connecter directement à la machine s’il connaissait le mot de passe de l’utilisateur. Cela ajoute une couche de sécurité supplémentaire et non négligeable.</p>
<p>Utilisons Google authentificator pour implémenter de la double authentification dans le PAM de notre système Linux. On commence par installer la librairie qui va bien :</p>
<p><img alt="../_images/1_install_google_auth.PNG" src="../_images/1_install_google_auth.PNG" /></p>
<p>Puis on exécute google-authenticator pour générer un token :</p>
<p><img alt="../_images/2_configure_google_auth.PNG" src="../_images/2_configure_google_auth.PNG" /></p>
<p>Configurons PAM et sshd pour qu’ils utilisent Google authentificator :</p>
<p><img alt="../_images/3_configure_pam.PNG" src="../_images/3_configure_pam.PNG" /></p>
<p>Et dans /etc/ssh/sshd-config</p>
<p><img alt="../_images/3_configure_sshd.PNG" src="../_images/3_configure_sshd.PNG" /></p>
<p>Puis vérifions que le mécanisme est fonctionel :</p>
<p><img alt="../_images/4_verification.PNG" src="../_images/4_verification.PNG" /></p>
</div>
</div>
<div class="section" id="commentaires">
<h2>Commentaires<a class="headerlink" href="#commentaires" title="Permalink to this headline">¶</a></h2>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="application_correctifs.html" class="btn btn-neutral float-right" title="Applications des correctifs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="installation.html" class="btn btn-neutral float-left" title="Procédure d’installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Bastien SECHER - Olivier CUREAU - Mael FANJOUX.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>